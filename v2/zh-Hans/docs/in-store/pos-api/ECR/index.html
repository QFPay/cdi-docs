<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-in-store/pos-api/ECR" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">ECR integration technical specification | Developer Centre</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://qfpay.github.io/docs/v2/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://qfpay.github.io/docs/v2/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://qfpay.github.io/docs/v2/zh-Hans/docs/in-store/pos-api/ECR"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ECR integration technical specification | Developer Centre"><meta data-rh="true" name="description" content="支持的终端型号:"><meta data-rh="true" property="og:description" content="支持的终端型号:"><link data-rh="true" rel="icon" href="/docs/v2/zh-Hans/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://qfpay.github.io/docs/v2/zh-Hans/docs/in-store/pos-api/ECR"><link data-rh="true" rel="alternate" href="https://qfpay.github.io/docs/v2/docs/in-store/pos-api/ECR" hreflang="en"><link data-rh="true" rel="alternate" href="https://qfpay.github.io/docs/v2/zh-Hans/docs/in-store/pos-api/ECR" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://qfpay.github.io/docs/v2/docs/in-store/pos-api/ECR" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/docs/v2/zh-Hans/blog/rss.xml" title="Developer Centre RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/v2/zh-Hans/blog/atom.xml" title="Developer Centre Atom Feed"><link rel="stylesheet" href="/docs/v2/zh-Hans/assets/css/styles.117cab51.css">
<script src="/docs/v2/zh-Hans/assets/js/runtime~main.8526d8a3.js" defer="defer"></script>
<script src="/docs/v2/zh-Hans/assets/js/main.53f38e83.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://qfpay.global/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs/v2/zh-Hans/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="20" width="112"><img src="/docs/v2/zh-Hans/img/logo_dark.jpg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="20" width="112"></div><b class="navbar__title text--truncate">开发者中心</b></a><a aria-current="page" class="navbar__item navbar__link qf-display-link navbar__link--active" href="/docs/v2/zh-Hans/">主页</a><a class="navbar__item navbar__link qf-display-link" href="/docs/v2/zh-Hans/docs/preparation/introduction">接口文档</a><div class="qf-search-bar navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/v2/docs/in-store/pos-api/ECR" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/docs/v2/zh-Hans/docs/in-store/pos-api/ECR" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/v2/zh-Hans/docs/category/preparation">接入准备</a><button aria-label="展开侧边栏分类 &#x27;接入准备&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/v2/zh-Hans/docs/category/in-store">线下支付</a><button aria-label="折叠侧边栏分类 &#x27;线下支付&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v2/zh-Hans/docs/in-store/MPM">正扫支付</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v2/zh-Hans/docs/in-store/CPM">反扫支付</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/v2/zh-Hans/docs/category/pos-api">POS API</a><button aria-label="折叠侧边栏分类 &#x27;POS API&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v2/zh-Hans/docs/in-store/pos-api/ECR">ECR Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v2/zh-Hans/docs/in-store/pos-api/app-call-app">App call App</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/v2/zh-Hans/docs/category/online-shop">线上支付</a><button aria-label="展开侧边栏分类 &#x27;线上支付&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/v2/zh-Hans/docs/category/common-api">常用API</a><button aria-label="展开侧边栏分类 &#x27;常用API&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v2/zh-Hans/docs/customs declaration">报关API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v2/zh-Hans/docs/FAQ">FAQs</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/docs/v2/zh-Hans/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/v2/zh-Hans/docs/category/in-store"><span itemprop="name">线下支付</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/v2/zh-Hans/docs/category/pos-api"><span itemprop="name">POS API</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ECR Integration</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>ECR integration technical specification</h1>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>支持的终端型号:</p><p>联迪 A8 &amp; A8S, 支持所有支付方式。
PAX A920, 仅支持二维码支付。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-pos-key">1. POS-KEY<a href="#1-pos-key" class="hash-link" aria-label="1. POS-KEY的直接链接" title="1. POS-KEY的直接链接">​</a></h2>
<p>在haojin app 设置中，有个设置调用秘钥选项。点击进入可以重新生成秘钥。默认秘钥是： <code>f46b1f08bec1f39104792cc79ec9aacd</code></p>
<br>
<p>默认加密处于打开状态。</p>
<p>有一个刷新 POS-KEY 的选项。 并且Haojin App需要刷新才有效</p>
<br>
<p><strong>刷新 POS-KEY 的步骤</strong>
登入 Haojin App -&gt; 我的 选项 -&gt; 设置 -&gt; 设备调用秘钥 -&gt; 重置秘钥</p>
<p><strong>检查 POS-KEY 的步骤</strong>
登入商户管理平台-&gt; 设置 -&gt; 设备设置 -&gt; POS秘钥管理</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-encryption">2. Encryption<a href="#2-encryption" class="hash-link" aria-label="2. Encryption的直接链接" title="2. Encryption的直接链接">​</a></h2>
<p>所有的数据信息都需要AES加密，加密AES_Key为上一步骤中生成的秘钥，加密用到的IV为：<code>qfpay202306_hjsh</code></p>
<br>
<p>数据经过加密后采用Base64编码。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-参数格式">3. 参数格式<a href="#3-参数格式" class="hash-link" aria-label="3. 参数格式的直接链接" title="3. 参数格式的直接链接">​</a></h2>
<table><thead><tr><th>参数名称</th><th>是否必填</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>amt</td><td>是</td><td>Double</td><td>金额, e.g. $10.1 =&gt; 10.1</td></tr><tr><td>func_type</td><td>是</td><td>String</td><td>指令代码</td></tr><tr><td>channel</td><td>是</td><td>String</td><td>钱包名称，参见通道列表</td></tr><tr><td>out_trade_no</td><td>否</td><td>String</td><td>商户参考。 <br> 如果不通过，则out_trade_no不会通过</td></tr><tr><td>camera_id</td><td>否</td><td>Integer</td><td>在反扫支付中可以选择使用前置摄像头或者后置摄像头<br> 0: 后置摄像头 (默认), <br> 1: 前置摄像头</td></tr><tr><td>wait_card_timeout</td><td>否</td><td>Integer</td><td>可以设置等待超时时间，单位为秒，默认120s</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-交易">3.1 交易<a href="#31-交易" class="hash-link" aria-label="3.1 交易的直接链接" title="3.1 交易的直接链接">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>对于二维码支付，根据上次使用情况自动选择 MPM/CPM 模式。</p><p>camera_id:正扫支付的时候可以切换前后摄像头,可以不传这个字段，默认是后置摄像头</p><p>0：CAMERA_PARAM_BACK  后置摄像头
1：CAMERA_PARAM_FROT  前置摄像头</p><p>wait_card_timeout :等待超时时间，可以不设置，默认120s, 类型int，值大于0</p></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;amt&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;camera_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;card_payment&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;func_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;out_trade_no&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;456799999999&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;wait_card_timeout&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;digest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;76b9186077cdc2bc5d78ae921309811d&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如需后端查询交易结果，请使用查询接口：<a href="https://sdk.qfapi.com/?python#transaction-enquiry" target="_blank" rel="noopener noreferrer">https://sdk.qfapi.com/?python#transaction-enquiry</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-退款撤销">3.2 退款/撤销<a href="#32-退款撤销" class="hash-link" aria-label="3.2 退款/撤销的直接链接" title="3.2 退款/撤销的直接链接">​</a></h3>
<p>初始化退款请求时，应用程序中无需输入密码</p>
<p>specific parameters</p>
<table><thead><tr><th>参数名称</th><th>是否必填</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>orderId</td><td>是</td><td>String</td><td>QFPay交易编号</td></tr><tr><td>refund_amount</td><td>否</td><td>String</td><td>默认退款金额为订单可退款金额，<br>支持部分退款</td></tr><tr><td>allow_modify_flag</td><td>否</td><td>Integer</td><td>0：不允许修改退款金额（默认值）<br> 1：允许修改退款金额</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><blockquote>
<p>对于卡支付、银联卡、运通卡，当日退款金额必须为“全额”</p>
</blockquote></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;allow_modify_flag&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;func_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1002</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;orderId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;order_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;refund_amount&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.05&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;digest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9C8E9FB05C7C24B6CA04EBFA1263EF41&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-打印小票">3.3 打印小票<a href="#33-打印小票" class="hash-link" aria-label="3.3 打印小票的直接链接" title="3.3 打印小票的直接链接">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;orderId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;12345678&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;func_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3001</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;digest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;79fd145311d54d03e4e685d50f15dd7f&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-打印交易汇总">3.4 打印交易汇总<a href="#34-打印交易汇总" class="hash-link" aria-label="3.4 打印交易汇总的直接链接" title="3.4 打印交易汇总的直接链接">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;func_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3002</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;digest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;79fd145311d54d03e4e685d50f15dd7f&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-根据订单id-查询交易信息">3.5 根据订单id 查询交易信息<a href="#35-根据订单id-查询交易信息" class="hash-link" aria-label="3.5 根据订单id 查询交易信息的直接链接" title="3.5 根据订单id 查询交易信息的直接链接">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;orderId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;12345678&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;func_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4001</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token property" style="color:#36acaa">&quot;digest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;99CE8BF9C7304AC964522D10F51660B4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="36-取消交易或者退款请求">3.6 取消交易或者退款请求<a href="#36-取消交易或者退款请求" class="hash-link" aria-label="3.6 取消交易或者退款请求的直接链接" title="3.6 取消交易或者退款请求的直接链接">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;func_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5001</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token property" style="color:#36acaa">&quot;digest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;99CE8BF9C7304AC964522D10F51660B4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>content：请求的数据信息
digest<!-- -->:content<!-- --> 数据的签名,按照字段顺序拼接成 字段=值 的形式，算签名,</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="生成签名">生成签名<a href="#生成签名" class="hash-link" aria-label="生成签名的直接链接" title="生成签名的直接链接">​</a></h2>
<p>生成签名示例</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// original payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">&quot;amt&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;channel&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;card_payment&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;func_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string-property property" style="color:#36acaa">&quot;out_trade_no&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;456799999999&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// sorted keys in alphabetical ascending order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">format_content</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">amt</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;card_payment&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">func_type</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">out_trade_no</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;456799999999&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> 这种格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// encryption</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// !! if the value is empty, pass &#x27;&#x27; (empty string) instead</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digest</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">format_content </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> pos_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digest</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">amt</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;card_payment&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">func_type</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">out_trade_no</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;456799999999&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">f46b1f08bec1f39104792cc79ec9aacd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果启用加密，则上述有效负载将在“content”处通过 AES 进行加密，并且“digest”将根据加密的有效负载计算。</p>
<p>示例</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;content&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{func_type: 3002}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;digest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;79fd145311d54d03e4e685d50f15dd7f&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-字段描述">4. 字段描述<a href="#4-字段描述" class="hash-link" aria-label="4. 字段描述的直接链接" title="4. 字段描述的直接链接">​</a></h2>
<p>1、 func_type : :业务类型
（1）1001 交易
（2）1002 退款
（3）3001 打印小票
（4）3002 打印交易汇总
（5）4001 查询交易信息
（6）5001 取消交易或者退款请求</p>
<p>2、channel: payment method
（1）、card_payment  刷卡交易
（2）、wx            微信支付
（3）、alipay        支付宝支付
（4）、payme         payme支付
（5）、union         银联支付
（6）、fps           FPS支付
（7）、octopus       八达通支付
（8）、unionpay_card     银联卡支付
（9）、amex_card     美国运通卡</p>
<p>3、amt: 交易金额</p>
<p>4、orderId: 交易订单号和 <code>out_trade_no</code> 相同</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-response-format">5. Response format<a href="#5-response-format" class="hash-link" aria-label="5. Response format的直接链接" title="5. Response format的直接链接">​</a></h2>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">\&quot;respcd\&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> \&quot;</span><span class="token number" style="color:#36acaa">6000</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\&quot;data\&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> \&quot;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;aaaaaa&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\&quot;respmsg\&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> \&quot;xxxxxxxxxx\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\&quot;resperr\&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">\&quot;xxxxxxxxxx\&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. respcd: response code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （1）、&quot;4003&quot;，请求拒绝，pos-key 不匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （2）、&quot;4004&quot;，请求方式不对，需要时post请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （3）、&quot;4005&quot;，其他报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （4）、&quot;4006&quot;，请求参数不正确  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （5）、&quot;4007&quot;，用户未登录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （6）、&quot;5001&quot;，解密失败</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （7）、&quot;6000&quot;  请求成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （8）、&quot;6001&quot;  用户取消  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （9）、&quot;6002&quot;  请求错误</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. respmsg：响应的信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. resperr：响应的错误信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. data:交易或者退款返回的数据，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （1）交易返回数据字段：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            respcd;请求响应码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            resmsg;请求信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reserr;错误信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mchntnm;商户名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sysdtm;系统时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            userid;userid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            busicd;业务代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            txamt;金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            txcurrcd;貨幣</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            chnlsn;通道序列號</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            paydtm;支付时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            udid;用户id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            syssn;流水号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clisn;客戶端序列號</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            out_trade_no；外部订单号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cardscheme；卡组织，例如：VISA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （2）退款返回数据字段：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            respcd;请求响应码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            resmsg;请求信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reserr;错误信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sysdtm;系统时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            paydtm;支付时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            txcurrcd;貨幣</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            txdtm;时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            orig_syssn;原生订单号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            out_trade_no;外部订单号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            syssn;系统流水号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            chnlsn;通道序列號</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            txamt;退款金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            originTxamt;原订单金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    （3）查询交易信息返回字段：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            server_time;服务器时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cancel;cancel状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clisn;客戶端序列號</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            opuid; 操作员id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            prepay_amt;支付金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            syssn;系统流水号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tradetp;交易方式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sysdtm;系统时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            txcurrcd;貨幣</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            origssn;原始流水号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            customer_source;消费者来源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            opuser;操作员</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nickname;用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            allow_refund_amt;允许退款金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            desc;描述信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            txamt;交易金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            busicd;业务代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            respcd;响应编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            origbusicd;原业务代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            chnlsn;通道序列號</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cardscheme；卡组织，例如：VISA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-usb-的数据传输方式">6. USB 的数据传输方式<a href="#6-usb-的数据传输方式" class="hash-link" aria-label="6. USB 的数据传输方式的直接链接" title="6. USB 的数据传输方式的直接链接">​</a></h2>
<ol>
<li>通过USB接口连接POS设备.</li>
<li>按照USB 通信协议构造数据。详情见第九条：&quot;收银机&amp; Pos 通信协议&quot;。</li>
<li>数据响应, 收到的数据需要按照通信协议解析，然后获取到数据报文，通过AES解密, 得到响应的数据.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-http-数据传输方式">7. HTTP 数据传输方式<a href="#7-http-数据传输方式" class="hash-link" aria-label="7. HTTP 数据传输方式的直接链接" title="7. HTTP 数据传输方式的直接链接">​</a></h2>
<ol>
<li>Http 数据传输方式需要先查看POS 的ip ,http 方式的端口默认为 9001.</li>
<li>数据报文格式:
(1) 将数据报文通过 AES 加密
(2) 通过http Post请求 发起请求</li>
<li>请求的api
(1) 交易: /api/pos/trade
(2) 退款: /api/pos/cancel
(3) 打印小票: /api/pos/print_receipt
(4) 打印交易汇总: /api/pos/transaction_info
(4) 查询交易信息: /api/pos/query_transaction
(5) 取消交易或者退款请求：/api/pos/cancel_request</li>
<li>请求头需要设置 请求的Content-type格式为：application/json</li>
<li>请求的结果需要 AES 解密得到响应的报文数据</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-tcp-数据传输方式">8. TCP 数据传输方式<a href="#8-tcp-数据传输方式" class="hash-link" aria-label="8. TCP 数据传输方式的直接链接" title="8. TCP 数据传输方式的直接链接">​</a></h2>
<ol>
<li>Http 数据传输方式需要先查看POS 的ip ,http 方式的端口默认为 9002.</li>
<li>收银机 通过socket连接 到POS</li>
<li>通过socket
传输数据，数据格式为数据报文 AES 加密后的加密数据，</li>
<li>请求的结果需要AES 解密得到响应的报文数据</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-收银机-pos-通信协议usb">9. 收银机&amp; Pos 通信协议（USB）<a href="#9-收银机-pos-通信协议usb" class="hash-link" aria-label="9. 收银机&amp; Pos 通信协议（USB）的直接链接" title="9. 收银机&amp; Pos 通信协议（USB）的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="91-产品应用场景">9.1 产品应用场景<a href="#91-产品应用场景" class="hash-link" aria-label="9.1 产品应用场景的直接链接" title="9.1 产品应用场景的直接链接">​</a></h3>
<p>收银机与智能Pos设备通过串口或蓝牙连接进行通信，实现收银机通过智能Pos上的好近商户App进行收款、撤销交易操作。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="92-通信方式">9.2 通信方式<a href="#92-通信方式" class="hash-link" aria-label="9.2 通信方式的直接链接" title="9.2 通信方式的直接链接">​</a></h3>
<p>串口</p>
<p>通过智能Pos设备上Micor USB接口或借用底座转成USB Host模式，由USB转串口线连接到收银机。</p>
<p>通信要求, 稳定, 安全, 可扩展</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="93-报文格式">9.3 报文格式<a href="#93-报文格式" class="hash-link" aria-label="9.3 报文格式的直接链接" title="9.3 报文格式的直接链接">​</a></h3>
<table><thead><tr><th>字段</th><th>内容</th><th>说明</th><th>长度</th></tr></thead><tbody><tr><td>开始字符</td><td>0x2f6e</td><td>标识一个报文的开始</td><td>2字节</td></tr><tr><td>协议版本</td><td>0x01</td><td>协议版本号(固定)</td><td>1字节</td></tr><tr><td>报文类型</td><td>0x10<br>0x20<br>0x30</td><td>请求报文/响应正常报文/响应错误报文</td><td>1字节</td></tr><tr><td>报文编号</td><td>0x01 ~ 0x7f</td><td>对报文的编号，用于报文应答或分包合并。<br>每次加1，循环使用</td><td>1字节</td></tr><tr><td>报文总长度</td><td></td><td>报文中各个字段内容(开始字符 ~ 结束字符)的字节长度的总和</td><td>2字节</td></tr><tr><td>报文数据域长度</td><td></td><td>报文包含的有效数据的长度，不包含报文其他部分</td><td>2字节</td></tr><tr><td>数据域</td><td></td><td>有效通信数据，utf-8编码</td><td>不固定</td></tr><tr><td>结束字符</td><td>0x2f6e</td><td>标识一个报文的结束</td><td>2字节</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="94-详细说明">9.4 详细说明<a href="#94-详细说明" class="hash-link" aria-label="9.4 详细说明的直接链接" title="9.4 详细说明的直接链  接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="报文开始结束字符">报文开始结束字符<a href="#报文开始结束字符" class="hash-link" aria-label="报文开始结束字符的直接链接" title="报文开始结束字符的直接链接">​</a></h4>
<p>为了避免在通信过程中，由于硬件原因发生一个数据报文被拆分成多个数据块的情况，导致无法正常获取报文内容。发送方在发送报文时，为每个报文添加开始和结束字符(0x2f6e)。</p>
<p>接收方收到报文后，会检查报文的前两个字节是否为开始字符(0x2f6e)，如果不是则响应错误报文(0x31)。否则继续遍历后续字节，直至结束字符。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p><em>0x2f6e代表ASCII编码的 <code>/n</code> 的十六进制表示</em></p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="报文错误类型">报文错误类型<a href="#报文错误类型" class="hash-link" aria-label="报文错误类型的直接链接" title="报文错误类型的直接链接">​</a></h4>
<table><thead><tr><th>错误报文类型</th><th>错误说明</th></tr></thead><tbody><tr><td>0x30</td><td>未知错误类型</td></tr><tr><td>0x31</td><td>报文格式错误</td></tr><tr><td>0x32</td><td>报文校验错误</td></tr><tr><td>0x33</td><td>数据域解密错误</td></tr><tr><td>0x34</td><td>数据域格式错误</td></tr><tr><td>0x35</td><td>数据分包错误</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="请 求和应答">请求和应答<a href="#请求和应答" class="hash-link" aria-label="请求和应答的直接链接" title="请求和应答的直接链接">​</a></h4>
<p>当接收方收到请求报文(报文类型为0x10)后，需要回送响应报文，来告知请求方报文的接收结果。如果校验成功响应报文类型为0x20，如果校验失败响应报文类型为0x32，响应报文编号与请求报文编号相同。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="响应超时">响应超时<a href="#响应超时" class="hash-link" aria-label="响应超时的直接链接" title="响应超时的直接链接">​</a></h4>
<p>应答报文超时时间为<em>1000</em>ms，超时后认为请求报文发送失败，设备连接断开。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="报文长度">报文长度<a href="#报文长度" class="hash-link" aria-label="报文长度的直接链接" title="报文长度的直接链接">​</a></h4>
<ol>
<li>报文总长度 :从开始字符到结束字符，所有报文字段字节长度的总和，便于多个包数据提取。</li>
<li>报文”数据域“字段的字节长度。</li>
<li>由于报文数据长度字段占2字节，所以报文中有效数据长度不得超过65536字节。</li>
<li>单个报文有效数据长度建议不超过1024字节，数据过大应分包发送。</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="数据包拆分与合并">数据包拆分与合并<a href="#数据包拆分与合并" class="hash-link" aria-label="数据包拆分与合并的直接链接" title="数据包拆分与合并的直接链接">​</a></h5>
<p>发送方分包发送时，多个包的报文编号相同，报文数据长度为总长度。
接收方接收到报文数据长度大于实际数据长度时，需等待继续接收后续相同报文编号的报文，直到报文数据长度等于实际数据长度，然后再发送响应报文。</p>
<p>接收方等待接收多个包的超时时间为<em>500</em>ms，超时后则丢弃 之前接收的报文。如果后续又接收到相同编号的报文，则发送错误(0x35)响应报文。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="数据加密">数据加密<a href="#数据加密" class="hash-link" aria-label="数据加密的直接链接" title="数据加密的直接链接">​</a></h4>
<p>报文发送方和接收方要对有效数据采用AES算法进行加解密，秘钥由服务提供方分配。</p>
<p>秘钥长度16字节128位</p>
<p>秘钥偏移量 *****</p>
<p>算法模式 CBC(Cipher Block Chaining) 加密块链</p>
<p>补码方式 PKCS5Padding</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="串口芯片设置">串口芯片设置<a href="#串口芯片设置" class="hash-link" aria-label="串口芯片设置的直接链接" title="串口芯片设置的直接链接">​</a></h4>
<p>波特率：9600
停止位：1
校验位：0
数据位：8
流控：关闭</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="支持的usb转串口线芯片类型">支持的USB转串口线芯片类型<a href="#支持的usb转串口线芯片类型" class="hash-link" aria-label="支持的USB转串口线芯片类型的直接链接" title="支持的USB转串口线芯片类型的直接链接">​</a></h5>
<p>PL2303HXD  支持
CH340       未支持
FT232       未支持</p>
<p>三个常用的芯片稳定程度和价格是一致的，FT232&gt;CH340&gt;PL2303</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例数据">示例数据<a href="#示例数据" class="hash-link" aria-label="示例数据的直接链接" title="示例数据的直接链接">​</a></h4>
<p>假设数据域为：</p>
<p><code>{\&quot;content\&quot;:\&quot;{\\\&quot;amt\\\&quot;:100,\\\&quot;channel\\\&quot;:\\\&quot;wx\\\&quot;,\\\&quot;funcType\\\&quot;:1,\\\&quot;mode\\\&quot;:1}\&quot;,\&quot;digest\&quot;:\&quot;2f0c4683e25a7b9407265033070e9034\&quot;}</code></p>
<p>完整数据报文（16进制）为：
<code>2f6e011001007f00747b22636f6e74656e74223a227b5c22616d745c223a3130302c5c226368616e6e656c5c223a5c2277785c222c5c2266756e63547970655c223a312c5c226d6f64655c223a317d222c22646967657374223a223266306334363833653235613762393430373236353033333037306539303334227d2f6e</code></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/v2/zh-Hans/docs/category/pos-api"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">POS API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/v2/zh-Hans/docs/in-store/pos-api/app-call-app"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">App call App Android SDK</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-pos-key" class="table-of-contents__link toc-highlight">1. POS-KEY</a></li><li><a href="#2-encryption" class="table-of-contents__link toc-highlight">2. Encryption</a></li><li><a href="#3-参数格式" class="table-of-contents__link toc-highlight">3. 参数格式</a><ul><li><a href="#31-交易" class="table-of-contents__link toc-highlight">3.1 交易</a></li><li><a href="#32-退款撤销" class="table-of-contents__link toc-highlight">3.2 退款/撤销</a></li><li><a href="#33-打印小票" class="table-of-contents__link toc-highlight">3.3 打印小票</a></li><li><a href="#34-打印交易汇总" class="table-of-contents__link toc-highlight">3.4 打印交易汇总</a></li><li><a href="#35-根据订单id-查询交易信息" class="table-of-contents__link toc-highlight">3.5 根据订单id 查询交易信息</a></li><li><a href="#36-取消交易或者退款请求" class="table-of-contents__link toc-highlight">3.6 取消交易或者退款请求</a></li></ul></li><li><a href="#生成签名" class="table-of-contents__link toc-highlight">生成签名</a></li><li><a href="#4-字段描述" class="table-of-contents__link toc-highlight">4. 字段描  述</a></li><li><a href="#5-response-format" class="table-of-contents__link toc-highlight">5. Response format</a></li><li><a href="#6-usb-的数据传输方式" class="table-of-contents__link toc-highlight">6. USB 的数据传输方式</a></li><li><a href="#7-http-数据传输方式" class="table-of-contents__link toc-highlight">7. HTTP 数据传输方式</a></li><li><a href="#8-tcp-数据传输方式" class="table-of-contents__link toc-highlight">8. TCP 数据传输方式</a></li><li><a href="#9-收银机-pos-通信协议usb" class="table-of-contents__link toc-highlight">9. 收银机&amp; Pos 通信协议（USB）</a><ul><li><a href="#91-产品应用场景" class="table-of-contents__link toc-highlight">9.1 产品应用场景</a></li><li><a href="#92-通信方式" class="table-of-contents__link toc-highlight">9.2 通信方式</a></li><li><a href="#93-报文格式" class="table-of-contents__link toc-highlight">9.3 报文格式</a></li><li><a href="#94-详细说明" class="table-of-contents__link toc-highlight">9.4 详细说明</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">QFPay Haojin Fintech Limited / iFlare Hong Kong Limited / Q Square Company Limited © 2024  |  Unit A, 27/F, West Gate Tower, 7 Wing Hong Street, Lai Chi Kok, Kowloon, Hong Kong |  All Rights Reserved</div></div></div></footer></div>
</body>
</html>